<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }

  body {
    background: linear-gradient(to bottom, #004D40, #00695C, #009688);
    min-height: 100vh;
    color: white;
    padding: 30px 0 40px;
  }

  h1 {
    text-align: center;
    font-size: 26px;
    font-weight: 800;
    margin-bottom: 25px;
  }

  .card {
    background: white;
    width: 92%;
    max-width: 480px;
    margin: 15px auto;
    padding: 20px;
    border-radius: 18px;
    box-shadow: 0 5px 16px rgba(0,0,0,0.28);
    color: #333;
    text-decoration: none;
    transition: 0.15s;
    display: block;
  }

  .card:hover { transform: scale(1.03); }

  .card-title {
    font-size: 20px;
    font-weight: 800;
    color: #00695C;
    margin-bottom: 8px;
  }

  .card-desc {
    font-size: 16px;
    color: #444;
  }

  /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± */
  .list-box {
    background: white;
    width: 92%;
    max-width: 480px;
    margin: 15px auto;
    padding: 15px;
    border-radius: 16px;
    color: #222;
  }

  .item {
    padding: 12px;
    border-bottom: 1px solid #ddd;
  }

  .item:last-child { border-bottom: none; }

  .btn {
    padding: 8px 14px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    margin: 4px;
    font-size: 15px;
  }

  .edit-btn { background: #00796B; color: white; }
  .del-btn { background: #D32F2F; color: white; }
  .add-btn { background: #004D40; color: white; width: 92%; max-width:480px; margin:10px auto; display:block; padding:12px; border-radius:14px; text-align:center; }

  /* Ø§Ù„Ù€ Popup */
  .popup {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.55);
    display: none;
    justify-content: center; align-items: center;
    padding: 15px;
  }

  .popup-content {
    background: white;
    width: 92%;
    max-width: 500px;
    padding: 20px;
    border-radius: 18px;
    color: #222;
  }

  .popup-content h3 {
    font-size: 21px;
    margin-bottom: 10px;
    color: #00695C;
    text-align: center;
    font-weight: 800;
  }

  input, textarea, select {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 10px;
    border: 1px solid #aaa;
    font-size: 16px;
  }

  #saveBtn {
    width: 100%; padding: 12px;
    background: #009688; color: white;
    border: none; border-radius: 12px;
    font-size: 18px; margin-top: 10px;
  }

  #closePopup {
    width: 100%; padding: 12px;
    background: #D32F2F; color: white;
    border: none; border-radius: 12px;
    font-size: 18px; margin-top: 10px;
  }
</style>
</head>

<body>

<h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>

<!-- Ø£Ø²Ø±Ø§Ø± -->
<a id="addDoctorBtn" class="add-btn">â• Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ± Ø¬Ø¯ÙŠØ¯</a>
<div id="doctorsList" class="list-box">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©...</div>

<a id="addHospitalBtn" class="add-btn">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ´ÙÙ‰ Ø¬Ø¯ÙŠØ¯</a>
<div id="hospitalsList" class="list-box">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª...</div>

<!-- Popup -->
<div class="popup" id="popup">
  <div class="popup-content">
    <h3 id="popupTitle"></h3>
    <form id="popupForm"></form>
    <button id="saveBtn">Ø­ÙØ¸</button>
    <button id="closePopup">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script type="module">
import { db } from "./firebase-config.js";
import { 
  collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const popup = document.getElementById("popup");
const popupTitle = document.getElementById("popupTitle");
const popupForm = document.getElementById("popupForm");
const saveBtn = document.getElementById("saveBtn");
const closePopup = document.getElementById("closePopup");

let currentCollection = "";
let editId = null;

/* ÙØªØ­ Ø§Ù„Ø¨ÙˆØ¨ Ø£Ø¨ */
function openPopup(title) {
  popupTitle.innerText = title;
  popup.style.display = "flex";
}

/* Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨ÙˆØ¨ Ø£Ø¨ */
closePopup.onclick = () => popup.style.display = "none";

/* ğŸ”¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Firebase */
onSnapshot(collection(db, "doctors"), (snap) => {
  const box = document.getElementById("doctorsList");
  box.innerHTML = "";
  snap.forEach((d) => {
    const data = d.data();
    box.innerHTML += `
      <div class="item">
        <b>${data.name}</b> â€” ${data.specialty}  
        <br>
        <button class="btn edit-btn" onclick="editDoctor('${d.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn del-btn" onclick="delDoctor('${d.id}')">Ø­Ø°Ù</button>
      </div>
    `;
  });
});

/* ğŸ”¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø© */
onSnapshot(collection(db, "hospitals"), (snap) => {
  const box = document.getElementById("hospitalsList");
  box.innerHTML = "";
  snap.forEach((h) => {
    const data = h.data();
    box.innerHTML += `
      <div class="item">
        <b>${data.name}</b> â€” ${data.city}  
        <br>
        <button class="btn edit-btn" onclick="editHospital('${h.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn del-btn" onclick="delHospital('${h.id}')">Ø­Ø°Ù</button>
      </div>
    `;
  });
});

/* -------------------------
    Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ±
------------------------- */
document.getElementById("addDoctorBtn").onclick = () => {
  currentCollection = "doctors";
  editId = null;
  popupForm.innerHTML = `
    <input placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±" id="name">
    <input placeholder="Ø§Ù„ØªØ®ØµØµ" id="specialty">
    <input placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰" id="hospital">
    <input placeholder="Ø§Ù„ØµÙˆØ±Ø© (Ø±Ø§Ø¨Ø·)" id="img">
    <input placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" id="phone">
  `;
  openPopup("Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ± Ø¬Ø¯ÙŠØ¯");
};

/* -------------------------
    Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ´ÙÙ‰
------------------------- */
document.getElementById("addHospitalBtn").onclick = () => {
  currentCollection = "hospitals";
  editId = null;
  popupForm.innerHTML = `
    <input placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰" id="name">
    <input placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" id="city">
    <textarea placeholder="Ø§Ù„Ø£Ù‚Ø³Ø§Ù…" id="department"></textarea>
    <textarea placeholder="Ø§Ù„ÙˆØµÙ" id="description"></textarea>
    <input placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" id="img">
    <input placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹" id="map">
    <input placeholder="Ø§Ù„Ù‡Ø§ØªÙ" id="phone">
  `;
  openPopup("Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ´ÙÙ‰ Ø¬Ø¯ÙŠØ¯");
};

/* Ø­ÙØ¸ */
saveBtn.onclick = async () => {
  const data = {};
  popupForm.querySelectorAll("input,textarea").forEach(i => {
    data[i.id] = i.value;
  });

  const col = collection(db, currentCollection);

  if (editId) {
    await updateDoc(doc(db, currentCollection, editId), data);
  } else {
    await addDoc(col, data);
  }

  popup.style.display = "none";
};

/* ØªØ¹Ø¯ÙŠÙ„ Ø¯ÙƒØªÙˆØ± */
window.editDoctor = async (id) => {
  const ref = doc(db, "doctors", id);
  const snap = await (await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js")).getDoc(ref);

  const d = snap.data();
  currentCollection = "doctors";
  editId = id;

  popupForm.innerHTML = `
    <input id="name" value="${d.name}">
    <input id="specialty" value="${d.specialty}">
    <input id="hospital" value="${d.hospital}">
    <input id="img" value="${d.img}">
    <input id="phone" value="${d.phone}">
  `;

  openPopup("ØªØ¹Ø¯ÙŠÙ„ Ø¯ÙƒØªÙˆØ±");
};

/* ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ´ÙÙ‰ */
window.editHospital = async (id) => {
  const ref = doc(db, "hospitals", id);
  const snap = await (await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js")).getDoc(ref);
  const h = snap.data();

  currentCollection = "hospitals";
  editId = id;

  popupForm.innerHTML = `
    <input id="name" value="${h.name}">
    <input id="city" value="${h.city}">
    <textarea id="department">${h.department}</textarea>
    <textarea id="description">${h.description}</textarea>
    <input id="img" value="${h.img}">
    <input id="map" value="${h.map}">
    <input id="phone" value="${h.phone}">
  `;

  openPopup("ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ´ÙÙ‰");
};

/* Ø­Ø°Ù */
window.delDoctor = (id) => deleteDoc(doc(db, "doctors", id));
window.delHospital = (id) => deleteDoc(doc(db, "hospitals", id));

</script>

</body>
</html>
