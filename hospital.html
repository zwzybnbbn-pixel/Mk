<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  * { font-family:'Cairo'; margin:0; padding:0; box-sizing:border-box; }

  body {
    background: linear-gradient(135deg, #e0f2f1, #b2dfdb);
    padding: 20px;
  }

  h1 {
    text-align:center;
    color:#004D40;
    margin-bottom:25px;
    font-size:32px;
    font-weight:800;
  }

  .card {
    background:white;
    padding:18px;
    border-radius:15px;
    box-shadow:0 4px 15px #00000022;
    margin-bottom:20px;
  }

  .card h3 {
    font-size:22px;
    color:#004D40;
    margin-bottom:10px;
    border-bottom:2px solid #009688;
    padding-bottom:6px;
  }

  .card p {
    font-size:17px;
    margin:6px 0;
    color:#444;
  }

  /* ØªÙ‚ÙŠÙŠÙ… */
  .rating {
    color:#ff9800;
    font-size:20px;
    margin-bottom:6px;
  }

  textarea {
    width:100%;
    padding:10px;
    border:1px solid #bbb;
    border-radius:10px;
    font-size:16px;
    resize:none;
  }

  .btn {
    width:100%;
    margin-top:12px;
    padding:12px;
    background:#00796B;
    color:white;
    border-radius:10px;
    font-size:18px;
    text-align:center;
    border:none;
  }

  .btn:hover { background:#009688; }

  @media (max-width:600px) {
    body { padding:10px; }
    h1 { font-size:26px; }
    .card { padding:15px; }
    .card p { font-size:15px; }
  }
</style>
</head>

<body>

<h1>ğŸ¥ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</h1>

<!-- Ø¨Ø·Ø§Ù‚Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ -->
<div id="info" class="card">ÙŠØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

<!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
<div class="card">
  <h3>â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h3>
  <div id="reviews">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª...</div>
</div>

<!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¶Ø§ÙØ© ØªÙ‚ÙŠÙŠÙ… -->
<div class="card">
  <h3>â• Ø¥Ø¶Ø§ÙØ© ØªÙ‚ÙŠÙŠÙ…</h3>

  <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (1 Ø¥Ù„Ù‰ 5):</label>
  <input id="rate" type="number" min="1" max="5" value="5" style="width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #bbb;">

  <label>Ø£ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ:</label>
  <textarea id="comment" rows="4"></textarea>

  <button class="btn" onclick="addReview()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
</div>

<script type="module">

  import { db } from "./firebase-config.js";
  import {
    doc, getDoc, collection, getDocs, addDoc, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  // ========== Ø¬Ù„Ø¨ ID Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ==========
  const urlParams = new URLSearchParams(window.location.search);
  const hospitalId = urlParams.get("id");

  // ========== ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ ==========
  async function loadHospital() {
    const ref = doc(db, "hospitals", hospitalId);
    const snap = await getDoc(ref);

    const box = document.getElementById("info");

    if (!snap.exists()) {
      box.innerHTML = "<p>âŒ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</p>";
      return;
    }

    const h = snap.data();

    box.innerHTML = `
      <h3>ğŸ¥ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</h3>
      <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${h.name}</p>
      <p><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${h.city}</p>
      <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${h.phone || "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}</p>
      <p><strong>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:</strong> ${h.departments || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>
    `;
  }

  // ========== ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ==========
  async function loadReviews() {
    const reviewsBox = document.getElementById("reviews");

    const ref = collection(db, "hospitals", hospitalId, "reviews");
    const snap = await getDocs(ref);

    if (snap.empty) {
      reviewsBox.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø¹Ø¯.</p>";
      return;
    }

    reviewsBox.innerHTML = "";
    snap.forEach(r => {
      const d = r.data();
      reviewsBox.innerHTML += `
        <div style="margin-bottom:12px;border-bottom:1px solid #eee;padding-bottom:8px;">
          <div class="rating">â­ ${d.rate}/5</div>
          <p>${d.comment}</p>
          <small style="color:#777;">${d.time?.toDate().toLocaleString() || ""}</small>
        </div>
      `;
    });
  }

  // ========== Ø¥Ø¶Ø§ÙØ© ØªÙ‚ÙŠÙŠÙ… ==========
  async function addReview() {
    const rate = document.getElementById("rate").value;
    const comment = document.getElementById("comment").value;

    if (comment.trim() === "") {
      alert("â— Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© ØªØ¹Ù„ÙŠÙ‚");
      return;
    }

    await addDoc(
      collection(db, "hospitals", hospitalId, "reviews"),
      {
        rate: Number(rate),
        comment: comment,
        time: serverTimestamp()
      }
    );

    alert("âœ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ ØªÙ‚ÙŠÙŠÙ…Ùƒ");
    loadReviews();
    document.getElementById("comment").value = "";
  }

  loadHospital();
  loadReviews();

</script>

</body>
</html>
