<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل الدكتور</title>
    <style>
        body {
            font-family: sans-serif;
            background: #f7f7f7;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        th {
            background: #0077ff;
            color: white;
        }
        .box {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }
        .title {
            font-size: 22px;
            margin-bottom: 10px;
            color: #0077ff;
        }
    </style>
</head>
<body>

<div class="box">
    <div class="title">بيانات الدكتور</div>
    <p><strong>الاسم:</strong> <span id="doc-name"></span></p>
    <p><strong>التخصص:</strong> <span id="doc-spec"></span></p>
    <p><strong>رقم الهاتف:</strong> <span id="doc-phone"></span></p>
    <p><strong>المستشفى الأساسي:</strong> <span id="doc-hospital"></span></p>
</div>

<div class="box">
    <div class="title">جدول الدوام</div>

    <table>
        <thead>
            <tr>
                <th>اليوم</th>
                <th>المستشفى</th>
                <th>الوقت</th>
            </tr>
        </thead>
        <tbody id="schedule-body"></tbody>
    </table>
</div>


<script type="module">
    import { db, doc, getDoc } from "./firebase-config.js";

    async function loadDoctor() {
        const urlParams = new URLSearchParams(window.location.search);
        const doctorId = urlParams.get("id");

        const doctorRef = doc(db, "doctors", doctorId);
        const doctorSnap = await getDoc(doctorRef);

        if (!doctorSnap.exists()) {
            alert("لم يتم العثور على بيانات الدكتور");
            return;
        }

        const data = doctorSnap.data();
        document.getElementById("doc-name").textContent = data.name;
        document.getElementById("doc-spec").textContent = data.specialty;
        document.getElementById("doc-phone").textContent = data.phone;

        // ============= جلب بيانات المستشفى =============
        let hospitalName = "—";
        if (data.hospitalId) {
            const hRef = doc(db, "hospitals", data.hospitalId);
            const hSnap = await getDoc(hRef);

            if (hSnap.exists()) {
                hospitalName = hSnap.data().name;
            }
        }
        document.getElementById("doc-hospital").textContent = hospitalName;
        // =================================================

        // ============= عرض جدول الدوام =============
        const scheduleBody = document.getElementById("schedule-body");
        const days = ["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];

        days.forEach(day => {
            if (data.schedule[day]) {
                const row = `
                    <tr>
                        <td>${day}</td>
                        <td>${data.schedule[day].hospital}</td>
                        <td>${data.schedule[day].time}</td>
                    </tr>
                `;
                scheduleBody.innerHTML += row;
            }
        });
    }

    loadDoctor();
</script>

</body>
</html>
