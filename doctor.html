<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>بيانات الدكتور</title>

    <link rel="stylesheet" href="style.css">

    <style>
        body { font-family: sans-serif; background:#f5f5f5; padding:10px; }
        .card { background:white; padding:20px; border-radius:10px; margin-bottom:20px; }
        h2 { color:#0077ff; text-align:center; }
        table { width:100%; border-collapse:collapse; margin-top:15px; }
        th, td { padding:10px; border:1px solid #ddd; text-align:center; }
        th { background:#0077ff; color:white; }
    </style>
</head>

<body>

<div class="card">
    <h2>بيانات الدكتور</h2>
    <p>الاسم: <span id="docName"></span></p>
    <p>التخصص: <span id="docSpec"></span></p>
    <p>رقم الهاتف: <span id="docPhone"></span></p>
    <p>المستشفى الأساسي: <span id="docHospital"></span></p>
</div>

<div class="card">
    <h2>جدول الدوام</h2>
    <table>
        <thead>
            <tr>
                <th>اليوم</th>
                <th>المستشفى</th>
                <th>الوقت</th>
            </tr>
        </thead>
        <tbody id="scheduleBody"></tbody>
    </table>
</div>

<script type="module">

// استدعاء Firebase Config
import { db } from "./firebase-config.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore-lite.js";

// ----------- جلب ID الدكتور من الرابط ----------
const urlParams = new URLSearchParams(window.location.search);
const doctorId = urlParams.get("id");

// ----------- تحميل بيانات الدكتور ----------
async function loadDoctor() {

    if (!doctorId) {
        alert("لا يوجد معرف للدكتور في الرابط!");
        return;
    }

    const doctorRef = doc(db, "doctors", doctorId);
    const doctorSnap = await getDoc(doctorRef);

    if (!doctorSnap.exists()) {
        alert("الدكتور غير موجود!");
        return;
    }

    const data = doctorSnap.data();

    document.getElementById("docName").textContent = data.name || "";
    document.getElementById("docSpec").textContent = data.specialty || "";
    document.getElementById("docPhone").textContent = data.phone || "";

    // -------- جلب اسم المستشفى الأساسي --------
    if (data.hospitalId) {
        const hospitalRef = doc(db, "hospitals", data.hospitalId);
        const hospitalSnap = await getDoc(hospitalRef);

        if (hospitalSnap.exists()) {
            document.getElementById("docHospital").textContent = hospitalSnap.data().name;
        } else {
            document.getElementById("docHospital").textContent = "غير موجود";
        }
    }

    // ----------- عرض جدول الدوام -----------
    const scheduleBody = document.getElementById("scheduleBody");
    scheduleBody.innerHTML = "";

    for (const day in data.schedule) {
        const s = data.schedule[day];

        const hospitalName = await getHospitalName(s.hospitalId);

        const row = `
            <tr>
                <td>${day}</td>
                <td>${hospitalName}</td>
                <td>${s.time}</td>
            </tr>
        `;
        scheduleBody.innerHTML += row;
    }
}

// --------- دالة لجلب اسم المستشفى ---------
async function getHospitalName(hospitalId) {
    if (!hospitalId) return "غير محدد";

    const ref = doc(db, "hospitals", hospitalId);
    const snap = await getDoc(ref);

    if (snap.exists()) return snap.data().name;

    return "غير موجود";
}

loadDoctor();

</script>

</body>
</html>

